<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta charset="utf-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
hr { height: 1px; border-width: 0; }
li.unchecked::marker { content: "\2610"; }
li.checked::marker { content: "\2612"; }
</style></head><body style=" font-family:'Microsoft YaHei UI'; font-size:14pt; font-weight:400; font-style:normal;">
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:24pt; font-weight:700;">文本编辑器项目设计说明</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700; color:#0000ff;">本「说明」使用该文本编辑器项目编辑并导出。</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; font-weight:700;">1. 需求分析</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">    </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">我们计划完成一个富文本编辑器。结合课程设计要求，我们考虑了如下几个方面的功能和目标；其中亮点使用<span style=" font-weight:700; color:#0000ff;">蓝色粗体</span>标出：</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">a. 文件操作：文件的新建、打开、保存、另存为、<span style=" font-weight:700; color:#0000ff;">导出为 PDF</span> 等</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">b. 文本格式：加粗、斜体、下划线、字号、颜色、字体等</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">c. 段落格式：左对齐、右对齐、居中对齐等</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">d. 编辑操作：粘贴（包括<span style=" font-weight:700; color:#0000ff;">粘贴图片</span>）、拷贝、剪切、<span style=" font-weight:700; color:#0000ff;">插入图片</span>、撤销、重做</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">e. 查找与替换</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">同时，我们考虑了很多关于用户体验的问题。例如上述大多数功能配备了对应的快捷键；在新建、打开文件和关闭窗口前，如果有未保存的修改，询问是否保存等。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; font-weight:700;">2. 总体设计</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">我们使用 Qt6 作为图形化界面的框架。由于界面比较简单和固定，我们只主要使用了一个 <span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">class </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">MainWindow </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">: </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">public </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QMainWindow </span>作为主界面。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">在这个界面中，主要有标题栏（显示当前文件路径）、工具栏和编辑区。界面的大小可以自行调整。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">工具栏按照需求分析中的 5 个分类做了分块；每个工具栏可以自由拖动。将鼠标悬浮在工具按钮上，将显示其功能和绑定的快捷键。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="1686250582026.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="1686250296975.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">为了界面美观，我们在 www.iconfont.cn 挑选了要用到的各种功能的按钮图标：</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="1686249849696.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; font-weight:700;">3. 系统模块说明</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">3.1 文本编辑器的界面设计</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">主界面使用如下类刻画：</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">class </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">MainWindow </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">: </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">public </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QMainWindow </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">{<br /></span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">public</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">:<br />    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">explicit </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">MainWindow</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">(</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QWidget </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">*parent = </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">nullptr</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">) : QMainWindow(parent) {...}<br />    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">void </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">closeEvent</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">(</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QCloseEvent</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">* event) </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">override;</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;"><br /><br /></span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">private</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">:<br />    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">void </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">initToolbars</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">    // ...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;"><br /></span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">private </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-weight:700; color:#1f542e;">slots</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">:<br /></span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">// </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">在这个类的构造函数中，我们调用函数 <span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">void </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">initToolbars</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">();</span> 来完成主界面的绘制。这一函数中，我们按照前述讨论，创建了 5 个工具栏，并添加了对应的按钮 <span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808; background-color:#ffffff;">QToolBar</span>，绑定了对应的槽函数。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">3.2 存储相关处理</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700; color:#ff0000;">[TODO]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">3.3 文本和段落格式相关处理</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700; color:#ff0000;">[TODO]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">3.4 编辑相关处理</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700; color:#ff0000;">[TODO]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">3.5 查找替换相关处理</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700; color:#ff0000;">[TODO]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; font-weight:700;">4. 系统设计难点及其解决</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">导出 PDF 并不是 QTextDocument 自带的功能。我们查阅资料后，本来选择了 QPdfWriter，但是以这种方式只能打印在单页 PDF 上。因此后来我们改用了 QPrinter。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">加入「导出PDF」功能过程中遇到的一个问题是，程序通过了编译，但运行出现「Process finished with exit code -1073741515 (0xC0000135)」的提示。经查阅资料，发现是 dll 找不到。经过排查后，发现 CMake 并没有把 Qt6PrintSupport.dll 正确复制到工程目录下。我们使用手动复制的方法暂时解决了这一问题。 </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">另一个问题是，由于 QPrinter 并不支持打印时进行缩放，因此图片经常会超宽。为了避免这种问题，我们在插入图片时新增了逻辑：如果图片宽度大于导出 PDF 的宽度，则对其进行等比例缩放，使其宽度变为适合打印的宽度。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">同时，粘贴剪切板中的图片也是一个困难的问题；网络上关于此的资料相对比较少。QTextEdit 并不支持这一功能。我们研究了 <span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QGuiApplication</span> 的相关接口，结合 mimeData 完成了剪切板中图片的识别和加载，然后将图片保存在本地后插入到文档中。为了支持快捷键，我们不再使用 QTextEdit，而是创建了一个继承自它的新类 MyTextEdit 从而屏蔽 QTextEdit 对粘贴快捷键 Ctrl+V 的绑定：</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">class </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">MyTextEdit </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">: </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">public </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QTextEdit </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">{<br /></span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">public</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">:<br />    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">explicit </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">MyTextEdit</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">(</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QWidget </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">*parent = </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">nullptr</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">) : QTextEdit(parent) {}<br />    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">void </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">customPaste</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">();<br /></span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">protected</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">:<br />    </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">void </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#00627a;">keyPressEvent</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">(</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QKeyEvent </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">*event) </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">override </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">{<br />        </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">if </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">(event-&gt;modifiers() </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">== Qt</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">::</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#871094;">ControlModifier </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">&amp;&amp; event-&gt;key() == </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">Qt</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">::</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#871094;">Key_V</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">) {<br />            </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">// </span><span style=" font-family:'宋体','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">处理</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;"> Ctrl + V </span><span style=" font-family:'宋体','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">快捷键<br />            </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">customPaste();<br />            </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#0033b3;">return</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">;<br />        }<br /><br />        </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">// </span><span style=" font-family:'宋体','monospace'; font-size:11.3pt; font-style:italic; color:#8c8c8c;">其他情况下，继续处理默认的键盘事件<br />        </span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QTextEdit</span><span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#080808;">::keyPressEvent(event);<br />    }<br />};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:18pt; font-weight:700;">5. 总结</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">总结而言，本工作实现了题目要求的所有基础目标和关键目标，并额外提供了导出 PDF、图片等功能。与此同时，本工作在使用 Qt 提供的 QTextDocument 和 QTextEdit 的同时，为了实现额外功能，对其做了扩展和丰富。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">在此过程中，我们在设计上做了充分的调研、准备和探索，对 Qt 有了比较深入的学习和讨论，对面向对象编程有了更加深刻的认识。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:24pt; font-weight:700;">程序使用说明</span></p>
<p align="center" style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700; color:#ff0000;">[TODO]</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:700; color:#ff0000;"><br /></p>
<p align="center" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:24pt; font-weight:700;">系统开发日志</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">由于时间或条件限制，以下问题暂时没有解决：</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">1. 窗口缩放功能</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">我们试图增加 Microsoft Word 那样的放大缩小功能；但是 QTextEdit 自带的 zoomIn 和 zoomOut 函数的实现方式实际上是更改字号；这对于我们的 HTML 富文本来说是没有用的。 </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">我们探索使用 CSS 来解决这个问题，并编写了这样的代码： </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Courier New'; font-size:11.5pt; color:#0033b3;">void </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#008080;">MainWindow</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">::</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#00627a;">zoom</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">(</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#371f80;">qreal </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">delta) {<br />    </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#0033b3;">static </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#371f80;">qreal </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#000000;">zoomFactor </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">= </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#1750eb;">1.0</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">;<br />    </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#000000;">zoomFactor </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">+= delta;<br />    </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#008080;">QString </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#000000;">css </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">= QString(</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#067d17;">&quot;body { transform: scale(%1); }&quot;</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">).arg(</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#000000;">zoomFactor</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">);<br />    </span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#660e7a;">textEdit</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">-&gt;document()-&gt;setDefaultStyleSheet(</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#000000;">css</span><span style=" font-family:'Courier New'; font-size:11.5pt; color:#080808;">);<br />}</span> </p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">不过仍然没有成功。查阅资料后，我们在 <a href="https://doc.qt.io/qt-6/richtext-html-subset.html#css-properties"><span style=" text-decoration: underline; color:#0000ff;">https://doc.qt.io/qt-6/richtext-html-subset.html#css-properties</span></a> 发现，目前 QTextEdit 所支持的 CSS 子集中并没有能完成这一工作的方法。</p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">进一步查阅资料后，我们发现网络上对此问题的实现大多仍然是调整字号，例如 <a href="https://stackoverflow.com/questions/8016530/no-effect-from-zoomin-in-qtextedit-after-font-size-change"><span style=" text-decoration: underline; color:#0000ff;">https://stackoverflow.com/questions/8016530/no-effect-from-zoomin-in-qtextedit-after-font-size-change</span></a> 。而这与我们其他部分的设计思路不符。最终，我们放弃了这一设计。 </p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">2. 图片质量问题</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">根据我们的设计，我们会在导入图片时对其进行缩放。但是，Qt 的相关功能会使得图片质量受损。我们暂时没有找到这个问题的解决方案。</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:700;">3. 含图片的文本粘贴问题</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">本工作能够实现程序内部的含图片文本粘贴，但对于其他来源的含图片文本，我们并不能完成处理。这是因为，我们处理图片粘贴是手动使用 <span style=" font-family:'JetBrains Mono','monospace'; font-size:11.3pt; color:#008080;">QGuiApplication</span> 相关接口实现的，而并不是使用 QTextEdit 原生支持的手段。如果我们希望支持其他来源的含图片文本，则需要对文本进行遍历和解析；这是比较难以实现的。因此，我们没有实现这一功能。</p></body></html>